import openpyxl
from docx import Document
import locale
import os
import shutil
import num2words

# Defina o locale para português brasileiro
locale.setlocale(locale.LC_ALL, 'pt_BR.utf8')

# Carregue o arquivo do Excel
wb = openpyxl.load_workbook('base_dados.xlsx')
ws = wb.active

# Carregue o arquivo do Word
doc = Document('carta_proposta.docx')

# Mapeie as strings específicas para as células específicas
mapa = {
    "nomedotecnico": (2, 1),
    "nomedonucleo": (2, 2),
    "tipodeatividade": (2, 3),
    "nomeatividade": (2, 4),
    "datadaatividade": (2, 5),
    "horarioinicio": (2, 6),
    "horariotermino": (2, 7),
    "localatividade": (2, 8),
    "valornumerico": (2, 9),
    "valorporextenso": (2, 10),
    "valorcache": (2, 11),
    "valorproducao": (2, 12),
}

# Obtenha o número de linhas com conteúdo
num_linhas = len([row for row in ws if any([cell.value for cell in row])])

# Itere sobre cada linha com conteúdo
for i in range(1, num_linhas + 1):
    # Crie uma cópia do arquivo do Word
    shutil.copy('carta_proposta.docx', f'carta_proposta_{i}.docx')

    # Carregue a cópia do arquivo do Word
    doc_copia = Document(f'carta_proposta_{i}.docx')

    # Substitua as strings específicas pelas células específicas
    for p in doc_copia.paragraphs:
        for key, value in mapa.items():
            if key in p.text:
                p.text = p.text.replace(key, str(ws.cell(row=i, column=value[1]).value))

    # Escreva o valor monetário na célula à direita
    valor = ws.cell(row=i, column=9).value

    # Verifique se o valor está no formato correto e converta-o se necessário
    if isinstance(valor, str):
        valor = valor.replace('R$', '').replace('.', '').replace(',', '.').strip()
        try:
            valor = float(valor)
        except ValueError:
            pass

    if isinstance(valor, (int, float)):
        ws.cell(row=i, column=10).value = locale.currency(valor, grouping=True)
        ws.cell(row=i, column=11).value = num2words.num2words(valor, lang='pt_BR', to='currency')
    else:
        # Trate valores inválidos aqui
        pass

    # Salve o arquivo do Word alterado
    nome_atividade = ws.cell(row=i, column=6).value
    doc_copia.save(f'carta_proposta_{nome_atividade}.docx')

# Salve o arquivo do Excel alterado
wb.save('exemplo_alterado.xlsx')
